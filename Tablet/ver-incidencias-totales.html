<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLANASA GMAO - Ver Incidencias</title>
    <link rel="stylesheet" href="ver-incidencias-totales.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="navbar-container"></div>

    <div class="container">


        <div class="filters-section">
            <div class="filter-group">
                <label for="importancia-filter">Importancia:</label>
                <select id="importancia-filter" onchange="filtrarSolicitudes()">
                    <option value="todas">Todas</option>
                    <option value="alta">Alta</option>
                    <option value="media">Media</option>
                    <option value="baja">Baja</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="tipo-filter">Tipo Mantenimiento:</label>
                <select id="tipo-filter" onchange="filtrarSolicitudes()">
                    <option value="todos">Todos</option>
                    <option value="Mantenimiento Preventivo">Preventivo</option>
                    <option value="Mantenimiento Correctivo">Correctivo</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="activo-filter">Tipo Activo:</label>
                <select id="activo-filter" onchange="filtrarSolicitudes()">
                    <option value="todos">Todos</option>
                    <option value="Tractor">Tractor</option>
                    <option value="Pulverizador">Pulverizador</option>
                    <option value="Cosechadora">Cosechadora</option>
                    <option value="Sistema de Riego">Sistema de Riego</option>
                    <option value="Generador">Generador</option>
                    <option value="Bomba">Bomba</option>
                    <option value="Cultivador">Cultivador</option>
                </select>
            </div>
        </div>

        <div class="solicitudes-container" id="solicitudes-lista">
            <!-- Las solicitudes se cargar√°n din√°micamente -->
        </div>

    </div>

    <!-- Modal para ver detalles de solicitud -->
    <div id="modal-detalle" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-titulo">Detalle de Solicitud</h2>
                <button class="modal-close" onclick="cerrarModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-contenido">
                <!-- Contenido se carga din√°micamente -->
            </div>
            <div class="modal-footer">
                <button class="btn-guardar" onclick="guardarCambios()">
                    <i class="fas fa-save"></i> Guardar Cambios
                </button>
                <button class="btn-crear-orden" onclick="crearOrdenTrabajo()">
                    <i class="fas fa-plus-circle"></i> Crear Orden de Trabajo
                </button>
                <button class="btn-cancelar" onclick="cerrarModal()">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para crear orden de trabajo -->
    <div id="modal-orden-trabajo" class="modal">
        <div class="modal-content wizard-modal">
            <div class="modal-header">
                <h2>üìã Crear Orden de Trabajo</h2>
                <button class="modal-close" onclick="cerrarModalOrden()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Resumen por filas -->
                <div class="resumen-filas">
                    <div class="fila-resumen editable" id="fila-criticidad" style="display: none;" onclick="editarPaso(1)">
                        <div class="fila-numero">1</div>
                        <div class="fila-contenido">
                            <div class="fila-titulo">Criticidad seleccionada</div>
                            <div class="fila-valor" id="valor-criticidad"></div>
                        </div>
                        <div class="fila-acciones">
                            <div class="fila-check">‚úì</div>
                            <div class="fila-editar">‚úèÔ∏è</div>
                        </div>
                    </div>
                    
                    <div class="fila-resumen editable" id="fila-fechas" style="display: none;" onclick="editarPaso(2)">
                        <div class="fila-numero">2</div>
                        <div class="fila-contenido">
                            <div class="fila-titulo">Fechas programadas</div>
                            <div class="fila-valor" id="valor-fechas"></div>
                        </div>
                        <div class="fila-acciones">
                            <div class="fila-check">‚úì</div>
                            <div class="fila-editar">‚úèÔ∏è</div>
                        </div>
                    </div>
                    
                    <div class="fila-resumen editable" id="fila-responsable" style="display: none;" onclick="editarPaso(3)">
                        <div class="fila-numero">3</div>
                        <div class="fila-contenido">
                            <div class="fila-titulo">T√©cnico asignado</div>
                            <div class="fila-valor" id="valor-responsable"></div>
                        </div>
                        <div class="fila-acciones">
                            <div class="fila-check">‚úì</div>
                            <div class="fila-editar">‚úèÔ∏è</div>
                        </div>
                    </div>
                </div>
                
                <div class="orden-wizard">
                    <!-- Paso 1: Criticidad -->
                    <div id="paso1" class="paso-wizard">
                        <h4>üö® ¬øQu√© criticidad tiene esta aver√≠a?</h4>
                        <div class="criticidad-options-simple">
                            <button class="criticidad-btn-simple baja" onclick="seleccionarCriticidad('Baja')">
                                üü¢ Baja
                            </button>
                            <button class="criticidad-btn-simple media" onclick="seleccionarCriticidad('Media')">
                                üü° Media
                            </button>
                            <button class="criticidad-btn-simple alta" onclick="seleccionarCriticidad('Alta')">
                                üü† Alta
                            </button>
                            <button class="criticidad-btn-simple critica" onclick="seleccionarCriticidad('Cr√≠tica')">
                                üî¥ Cr√≠tica
                            </button>
                        </div>
                    </div>

                    <!-- Paso 2: Fechas -->
                    <div id="paso2" class="paso-wizard" style="display: none;">
                        <h4>üìÖ ¬øCu√°ndo hacerlo?</h4>
                        <div class="fechas-programadas">
                            <div class="campo-fecha-programada">
                                <label>Fecha de inicio:</label>
                                <input type="date" id="fechaInicio" onchange="validarFechasProgramadas()">
                            </div>
                            <div class="campo-fecha-programada">
                                <label>Duraci√≥n (horas):</label>
                                <input type="number" id="duracionHoras" min="0.5" step="0.5" placeholder="Ej: 4" onchange="validarFechasProgramadas()">
                            </div>
                        </div>
                    </div>

                    <!-- Paso 3: Responsable -->
                    <div id="paso3" class="paso-wizard" style="display: none;">
                        <h4>üë• Equipo que ejecuta el trabajo</h4>
                        <div class="responsable-simple" style="margin-bottom:1rem;">
                            <label style="font-weight:600;">T√©cnico responsable (obligatorio):</label>
                            <select id="responsable" onchange="validarResponsable()">
                                <option value="">Seleccionar t√©cnico...</option>
                                <option value="Carlos M√©ndez">üë®‚Äçüîß Carlos M√©ndez</option>
                                <option value="Ana Garc√≠a">üë©‚Äçüîß Ana Garc√≠a</option>
                                <option value="Luis Fern√°ndez">üë®‚Äçüîß Luis Fern√°ndez</option>
                                <option value="Mar√≠a Ruiz">üë©‚Äçüîß Mar√≠a Ruiz</option>
                                <option value="Diego L√≥pez">üë®‚Äçüîß Diego L√≥pez</option>
                            </select>
                        </div>
                        <div class="equipo-apoyo-wrapper">
                            <div class="equipo-apoyo-header">
                                <div class="equipo-apoyo-title">Equipo de apoyo (opcional)</div>
                                <div class="equipo-apoyo-contador" id="contador-ayudantes">0 seleccionados</div>
                            </div>
                            <div class="equipo-apoyo-search">
                                <input type="text" id="filtroAyudantes" placeholder="Filtrar nombres..." oninput="filtrarAyudantes()">
                                <button type="button" class="btn-limpiar-ayudantes" onclick="limpiarAyudantes()" title="Limpiar selecci√≥n">‚úñ</button>
                            </div>
                            <div class="equipo-apoyo-list">
                                <label class="equipo-checkbox" data-nombre="carlos mendez"><input type="checkbox" value="Carlos M√©ndez" onchange="actualizarEquipoApoyo()"><span class="avatar-ayudante">CM</span><span class="nombre-ayudante">Carlos M√©ndez</span></label>
                                <label class="equipo-checkbox" data-nombre="ana garcia"><input type="checkbox" value="Ana Garc√≠a" onchange="actualizarEquipoApoyo()"><span class="avatar-ayudante">AG</span><span class="nombre-ayudante">Ana Garc√≠a</span></label>
                                <label class="equipo-checkbox" data-nombre="luis fernandez"><input type="checkbox" value="Luis Fern√°ndez" onchange="actualizarEquipoApoyo()"><span class="avatar-ayudante">LF</span><span class="nombre-ayudante">Luis Fern√°ndez</span></label>
                                <label class="equipo-checkbox" data-nombre="mar√≠a ruiz maria ruiz"><input type="checkbox" value="Mar√≠a Ruiz" onchange="actualizarEquipoApoyo()"><span class="avatar-ayudante">MR</span><span class="nombre-ayudante">Mar√≠a Ruiz</span></label>
                                <label class="equipo-checkbox" data-nombre="diego lopez"><input type="checkbox" value="Diego L√≥pez" onchange="actualizarEquipoApoyo()"><span class="avatar-ayudante">DL</span><span class="nombre-ayudante">Diego L√≥pez</span></label>
                            </div>
                            <div class="equipo-apoyo-footer">Selecciona los t√©cnicos que apoyar√°n al responsable.</div>
                        </div>
                        <button id="btnSiguienteResponsable" class="btn-continuar" onclick="siguientePaso(4)" disabled>
                            Continuar
                        </button>
                    </div>

                    <!-- Paso 4: Lista de Tareas -->
                    <div id="paso4" class="paso-wizard" style="display: none;">
                        <h4>üìù Tareas y Descripci√≥n (Opcional)</h4>
                        
                        <!-- Selector de tipo para cargar tareas -->
                        <div class="tipo-selector-wrapper">
                            <label for="tipoTrabajo">Tipo de trabajo:</label>
                            <select id="tipoTrabajo" onchange="cargarTareasPredeterminadas()">
                                <option value="">Seleccionar tipo...</option>
                                <option value="preventivo-motor">Mantenimiento Preventivo - Motor</option>
                                <option value="preventivo-hidraulico">Mantenimiento Preventivo - Sistema Hidr√°ulico</option>
                                <option value="preventivo-electrico">Mantenimiento Preventivo - Sistema El√©ctrico</option>
                                <option value="correctivo-mecanico">Mantenimiento Correctivo - Mec√°nico</option>
                                <option value="correctivo-electrico">Mantenimiento Correctivo - El√©ctrico</option>
                                <option value="correctivo-hidraulico">Mantenimiento Correctivo - Hidr√°ulico</option>
                            </select>
                        </div>

                        <!-- Contenido en 2 columnas -->
                        <div class="contenido-dos-columnas">
                            <!-- Columna izquierda: Lista de tareas -->
                            <div class="columna-tareas">
                                <div class="tareas-editables-container">
                                    <div class="tareas-header">
                                        <h5>Tareas programadas (opcional)</h5>
                                        <button type="button" onclick="a√±adirTareaNueva()" class="btn-a√±adir-tarea">+ A√±adir tarea</button>
                                    </div>
                                    <div id="lista-tareas-editables" class="lista-tareas">
                                        <p class="sin-tareas">Puedes seleccionar un tipo de trabajo para cargar tareas predeterminadas o dejar vac√≠o</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Columna derecha: Descripci√≥n -->
                            <div class="columna-descripcion">
                                <div class="descripcion-adicional">
                                    <h5>Descripci√≥n adicional (opcional)</h5>
                                    <textarea id="descripcionOrden" placeholder="Puedes a√±adir informaci√≥n adicional sobre el trabajo, pero no es obligatorio..." rows="12"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="wizard-acciones-finales">
                            <button onclick="crearOrden()" class="btn-crear-final">
                                ‚úÖ Crear Orden de Trabajo
                            </button>
                            <button onclick="cerrarModalOrden()" class="btn-cancelar-final">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="ver-incidencias-totales.js"></script>
    <script>
        // Cargar navbar
        fetch('../Components/navbar.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('navbar-container').innerHTML = html;
                // Mostrar el bot√≥n de volver despu√©s de cargar el navbar
                setTimeout(() => {
                    const btnVolver = document.getElementById('btn-volver-nav');
                    if (btnVolver) {
                        btnVolver.classList.add('show');
                    }
                }, 100);
            })
            .catch(error => {
                console.error('Error cargando navbar:', error);
            });
    </script>
</body>
</html>