<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLANASA GMAO - Crear Orden de Trabajo</title>
    <link rel="stylesheet" href="crear-orden-trabajo.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="navbar-container"></div>

    <div class="container">
        <div class="wizard-container">
            <!-- Resumen por filas progresivo -->
            <div class="resumen-filas">
                <div class="fila-resumen editable" id="fila-tipo-activo" style="display: none;" onclick="editarPaso(1)">
                    <div class="fila-numero">1</div>
                    <div class="fila-contenido">
                        <div class="fila-titulo">Tipo de activo</div>
                        <div class="fila-valor" id="valor-tipo-activo"></div>
                    </div>
                    <div class="fila-acciones">
                        <div class="fila-check">‚úì</div>
                        <div class="fila-editar">‚úèÔ∏è</div>
                    </div>
                </div>
                
                <div class="fila-resumen editable" id="fila-activo" style="display: none;" onclick="editarPaso(2)">
                    <div class="fila-numero">2</div>
                    <div class="fila-contenido">
                        <div class="fila-titulo">Activo seleccionado</div>
                        <div class="fila-valor" id="valor-activo"></div>
                    </div>
                    <div class="fila-acciones">
                        <div class="fila-check">‚úì</div>
                        <div class="fila-editar">‚úèÔ∏è</div>
                    </div>
                </div>
                
                <div class="fila-resumen editable" id="fila-tipo-mantenimiento" style="display: none;" onclick="editarPaso(3)">
                    <div class="fila-numero">3</div>
                    <div class="fila-contenido">
                        <div class="fila-titulo">Tipo de mantenimiento</div>
                        <div class="fila-valor" id="valor-tipo-mantenimiento"></div>
                    </div>
                    <div class="fila-acciones">
                        <div class="fila-check">‚úì</div>
                        <div class="fila-editar">‚úèÔ∏è</div>
                    </div>
                </div>
                
                <div class="fila-resumen editable" id="fila-tipo-averia" style="display: none;" onclick="editarPaso(4)">
                    <div class="fila-numero">4</div>
                    <div class="fila-contenido">
                        <div class="fila-titulo">Tipo de aver√≠a</div>
                        <div class="fila-valor" id="valor-tipo-averia"></div>
                    </div>
                    <div class="fila-acciones">
                        <div class="fila-check">‚úì</div>
                        <div class="fila-editar">‚úèÔ∏è</div>
                    </div>
                </div>
                
                <div class="fila-resumen editable" id="fila-descripcion-averia" style="display: none;" onclick="editarPaso('4_5')">
                    <div class="fila-numero">4.5</div>
                    <div class="fila-contenido">
                        <div class="fila-titulo">Descripci√≥n problema</div>
                        <div class="fila-valor" id="valor-descripcion-averia"></div>
                    </div>
                    <div class="fila-acciones">
                        <div class="fila-check">‚úì</div>
                        <div class="fila-editar">‚úèÔ∏è</div>
                    </div>
                </div>
                
                <div class="fila-resumen editable" id="fila-prioridad" style="display: none;" onclick="editarPaso(5)">
                    <div class="fila-numero">5</div>
                    <div class="fila-contenido">
                        <div class="fila-titulo">Prioridad de aver√≠a</div>
                        <div class="fila-valor" id="valor-prioridad"></div>
                    </div>
                    <div class="fila-acciones">
                        <div class="fila-check">‚úì</div>
                        <div class="fila-editar">‚úèÔ∏è</div>
                    </div>
                </div>
                
                <div class="fila-resumen editable" id="fila-responsable" style="display: none;" onclick="editarPaso(6)">
                    <div class="fila-numero">6</div>
                    <div class="fila-contenido">
                        <div class="fila-titulo">T√©cnico asignado</div>
                        <div class="fila-valor" id="valor-responsable"></div>
                    </div>
                    <div class="fila-acciones">
                        <div class="fila-check">‚úì</div>
                        <div class="fila-editar">‚úèÔ∏è</div>
                    </div>
                </div>
                
                <div class="fila-resumen editable" id="fila-fechas" style="display: none;" onclick="editarPaso(7)">
                    <div class="fila-numero">7</div>
                    <div class="fila-contenido">
                        <div class="fila-titulo">Fechas programadas</div>
                        <div class="fila-valor" id="valor-fechas"></div>
                    </div>
                    <div class="fila-acciones">
                        <div class="fila-check">‚úì</div>
                        <div class="fila-editar">‚úèÔ∏è</div>
                    </div>
                </div>
            </div>

            <!-- Paso 1: Tipo de activo -->
            <div id="paso1" class="paso-wizard">
                <div class="campo-simple">
                    <label>Tipo de activo:</label>
                    <select id="tipoActivo" onchange="seleccionarTipoActivo()">
                        <option value="">Seleccionar tipo...</option>
                        <option value="maquinaria">üöú Maquinaria Agr√≠cola</option>
                        <option value="infraestructura">üè¢ Infraestructura</option>
                        <option value="vehiculos">üöó Veh√≠culos</option>
                        <option value="equipos">‚öôÔ∏è Equipos Auxiliares</option>
                    </select>
                </div>
            </div>

            <!-- Paso 2: Seleccionar activo espec√≠fico -->
            <div id="paso2" class="paso-wizard" style="display: none;">
                <div class="campo-simple">
                    <label>Activo espec√≠fico:</label>
                    <select id="activoEspecifico" onchange="seleccionarActivo()">
                        <option value="">Seleccionar activo...</option>
                        <!-- Se carga din√°micamente seg√∫n el tipo seleccionado -->
                    </select>
                </div>
            </div>

            <!-- Paso 3: Tipo de mantenimiento -->
            <div id="paso3" class="paso-wizard" style="display: none;">
                <div class="campo-simple">
                    <label>Tipo de mantenimiento:</label>
                    <select id="tipoMantenimiento" onchange="seleccionarTipoMantenimiento()">
                        <option value="">Seleccionar tipo...</option>
                        <option value="preventivo">üõ°Ô∏è Preventivo</option>
                        <option value="correctivo">üö® Correctivo</option>
                    </select>
                </div>
            </div>

            <!-- Paso 4: Tipo de aver√≠a (solo si es correctivo) -->
            <div id="paso4" class="paso-wizard" style="display: none;">
                <div class="campo-simple">
                    <label>Tipo de aver√≠a:</label>
                    <select id="tipoAveria" onchange="seleccionarTipoAveria()">
                        <option value="">Seleccionar tipo...</option>
                        <!-- Se carga din√°micamente seg√∫n el tipo de mantenimiento -->
                    </select>
                </div>
            </div>

            <!-- Paso 4.5: Descripci√≥n espec√≠fica de la aver√≠a -->
            <div id="paso4_5" class="paso-wizard" style="display: none;">
                <div class="campo-simple">
                    <label>¬øQu√© le pasa exactamente?</label>
                    <textarea id="descripcionAveria" 
                              placeholder="Describe espec√≠ficamente qu√© problema tiene (ej: 'No arranca', 'Hace ruido extra√±o', 'Pierde aceite')..." 
                              rows="4" 
                              oninput="validarDescripcionAveria()"></textarea>
                    <button id="btnContinuarDescripcion" 
                            class="btn-continuar-descripcion" 
                            onclick="continuarDesdePrioridadDescripcion()" 
                            style="display: none;">
                        Continuar ‚Üí
                    </button>
                </div>
            </div>

            <!-- Paso 5: Prioridad de aver√≠a -->
            <div id="paso5" class="paso-wizard" style="display: none;">
                <div class="campo-simple">
                    <label>Prioridad:</label>
                    <select id="prioridad" onchange="seleccionarPrioridad()">
                        <option value="">Seleccionar prioridad...</option>
                        <option value="Baja">üü¢ Baja</option>
                        <option value="Media">üü° Media</option>
                        <option value="Alta">üü† Alta</option>
                        <option value="Cr√≠tica">üî¥ Cr√≠tica</option>
                    </select>
                </div>
            </div>

            <!-- Paso 6: Responsable -->
            <div id="paso6" class="paso-wizard" style="display: none;">
                <div class="campo-simple">
                    <label>Responsable:</label>
                    <select id="responsable" onchange="seleccionarResponsable()">
                        <option value="">Seleccionar t√©cnico...</option>
                        <option value="Carlos M√©ndez">üë®‚Äçüîß Carlos M√©ndez</option>
                        <option value="Ana Garc√≠a">üë©‚Äçüîß Ana Garc√≠a</option>
                        <option value="Luis Rodr√≠guez">üë®‚Äçüîß Luis Rodr√≠guez</option>
                        <option value="Mar√≠a L√≥pez">üë©‚Äçüîß Mar√≠a L√≥pez</option>
                    </select>
                </div>
            </div>



            <!-- Paso 7: Fechas -->
            <div id="paso7" class="paso-wizard" style="display: none;">
                <div class="fechas-programadas">
                    <div class="campo-fecha-programada">
                        <label>Fecha de inicio:</label>
                        <input type="date" id="fechaInicio" onchange="validarFechasProgramadas()">
                    </div>
                    <div class="campo-fecha-programada">
                        <label>Fecha de finalizaci√≥n:</label>
                        <input type="date" id="fechaFin" onchange="validarFechasProgramadas()">
                    </div>
                </div>
            </div>

            <!-- Paso 8: Tareas y descripci√≥n -->
            <div id="paso8" class="paso-wizard" style="display: none;">
                
                <!-- Contenido en 2 columnas -->
                <div class="contenido-dos-columnas">
                    <!-- Columna izquierda: Lista de tareas -->
                    <div class="columna-tareas">
                        <div class="tareas-editables-container">
                            <div class="tareas-header">
                                <h5>Tareas programadas (opcional)</h5>
                                <button type="button" onclick="a√±adirTareaNueva()" class="btn-a√±adir-tarea">+ A√±adir tarea</button>
                            </div>
                            <div id="lista-tareas-editables" class="lista-tareas">
                                <!-- Se cargan din√°micamente seg√∫n el tipo seleccionado -->
                            </div>
                        </div>
                    </div>

                    <!-- Columna derecha: Descripci√≥n -->
                    <div class="columna-descripcion">
                        <div class="descripcion-adicional">
                            <h5>Descripci√≥n adicional (opcional)</h5>
                            <textarea id="descripcionOrden" placeholder="Puedes a√±adir informaci√≥n adicional sobre el trabajo, pero no es obligatorio..." rows="12"></textarea>
                        </div>
                    </div>
                </div>

                <div class="wizard-acciones-finales">
                    <button onclick="crearOrdenCompleta()" class="btn-crear-final">
                        ‚úÖ Crear Orden de Trabajo
                    </button>
                    <button onclick="cancelarCreacion()" class="btn-cancelar-final">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="crear-orden-trabajo.js"></script>
    <script>
        // Cargar navbar
        fetch('../Components/navbar.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('navbar-container').innerHTML = html;
                
                // Mostrar el bot√≥n volver despu√©s de cargar la navbar
                setTimeout(() => {
                    const btnVolver = document.getElementById('btn-volver-nav');
                    if (btnVolver) {
                        btnVolver.style.display = 'flex';
                    }
                }, 100);
            })
            .catch(error => {
                console.error('Error cargando navbar:', error);
            });
            
        // Funci√≥n para volver atr√°s
        function volverAtras() {
            window.history.back();
        }
    </script>
</body>
</html>